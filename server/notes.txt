const dotenv = require('dotenv');

dotenv.config({ path: `${__dirname}/.env` })

// Express Setup
const express = require('express');
const cors = require('cors');
const app = express();



// Parses incoming JSON requests and puts the parsed data in req.body
app.use(express.json());

const corsOptions = {
  origin: 'http://localhost:4000',
  credentials: true,            //access-control-allow-credentials:true
  optionSuccessStatus: 200
}
app.use(cors(corsOptions));
app.use((req, res, next) => {
  console.log(req.path, req.method);
  next();
});

const { auth, createUserWithEmailAndPassword } = require("./firebase")


//app routing
const userRoutes = require ('./routes/userRoutes');
// app.use('/api/users', userRoutes);

app.post('/api', (req, res, next) =>{
  const { getData } = require('./firebase.js');
  console.log("Logging the req.body: ", req.body.username)
  const returnVal = getData;
  console.log("sending data")
  const jsonfile = {
    hello: "hello",
    bye: "bye"
  }
  res.send(jsonfile);
  next();
})

app.post('/userCreation', (req, res, next) => {
  datapacket = req.body;
  username = datapacket.username;
  password = datapacket.username;
  createUserWithEmailAndPassword(auth, username, password)
    .then(userCredentials => {
      const user = userCredentials.user;
      console.log("Created user with username ", user.username)
    });
  res.send({username, password})
})

app.listen(process.env.REACT_APP_SERVER_PORT, () => {
    console.log('App listening on port ' + process.env.REACT_APP_SERVER_PORT);
});
